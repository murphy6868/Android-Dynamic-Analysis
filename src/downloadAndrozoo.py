import requests
from pathlib import Path
# https://github.com/JordanSamhi/TriggerZoo/blob/master/infected_apps
sha256s = [
    "84419C0405725EBCAD37A772BDFAC08EE05626B4D34F345D6F34ED82F8F5E3ED",
    "8B5C782A2B0F190C9D4B29768D983275A9BB1ACF09B8E6C8C0BA423E34D637D0",
    "5BC0E58D71C16AE4C65AF2ADE09C222F9CF6630EA3B12A4BE172500800DC4180",
    "41BC3273A3A76352AC0E77C02B362AB215201BA585F71435722F2E7906AD9C14",
    "5A99C0A4E8C459993048508AF34F5C650C08DD17B32CAE0524E350A6610A29E9",
    "71A6922D4AF93066C737B78D4F9AE78CCF3D239FAC4615D2F7560D8F05E9AC24",
    "06C388340F5024793F1D14D413E2DE187ECD3F0427E9908B31E2BA11C93D6611",
    "F307E4DB2E5BDE85716A663FBA943073A880BB92031F1F052B81CB6B0FE7FDD2",
    "467BAC02C3ED0F63A08238E2AD906957D5F5687F1654DD73307E5DB633414233",
    "008EEAA66D7AFFEA85B4635EF6EC0E45B2AE69770A80AFD1723F166D3257CDE6",
    "780800B6359328938A5D181C15D74085E860F1305559577130D14078899A8A0C",
    "B7181B64452D0D6104E61CC0BBD9177FD7ED19E521A6F436F44A3BF9373F0ABE",
    "372F217755ECD81E384C237780EA19E2377C186094C8D92B0E2DD7EC41AC4B8A",
    "8DA1971C3B3FA78EC7DD2C18EC917A42EE451B3E88CEE2152D10981DEE79AE34",
    "988A948633D5D5D4D659A1B03035C926958F8EBED7F75ECD4F03D08E56798E3B",
    "5E0EBE018FBDC80DE1C9726DE3E8BE60526906DB7EB67D8ECAD1D1D086E9A38E",
    "527E6910F041A5FE6820E54B6597403CBC5907B4169373801D54CA4453920FC9",
    "851809EF0B0F3FBD3031B457A1B55DA1E5D176F83C2598588EEF6C5E82946A6F",
    "2D6947F82FCD7B92F4F5D92E6E6C408008C5FF033FB7AD6F3544F03F8220278B",
    "62F98FE25EC9BAFA10F242AB85C0B76F881B3193CECF73E52EAD9FA4E9C5E01C",
    "A1AC55405D2B7B34910C4E0EAEFE078070952752F7D575770CD7E6D5BF7015F1",
    "5A75D35DAB7320D2E1590F948DE3FD40D7FF7B3585196387222D2F8B980E303A",
    "AC67DF668FCDD3D1A0C224ACF639B91881A69074A15F03EBB83356EBFE7A9FD2",
    "F9B8316929B23412B7C73A32667E944E821C3BE9ADCC2BEDF701D7B0C8953F5B",
    "DD8A83CB9F7FD7EA84AC9017A58B844F43AE596C96CF2D2A8520992B008CBE10",
    "8737F56F1866A17CE40C292D1EA5C4AA819868FD2DE00E7283F3D877BDEA1618",
    "D9BC9E7EEF59864DE87887A3A25B007E154246F7FE6762961771A069E5072C23",
    "FCD2F893781C6B6AE7CCBA95B934A1D491513165395D8CB6344830F1862C356D",
    "43D44AF324B914E110EABF3C295FA8013C83A83CAA28E9CD079E2D3D0DF843FC",
    "5CAE0C88C824019D297128C0CBB41B408D45FA3E893F25E06EFCC1061C168961",
    "23444CC7EDE08193D93C0E91F520269256528D0391DA558CD1EDB5E5E830B55C",
    "051551CA38576FAEE62653A3B07FE9D25AFFE885C63C6A7D818D11D347E74AD6",
    "4A1DA7550FA3F9567838BED6F0BB03D587AF9646DD353C6479D75532F536790F",
    "D0B52056094B32414F04B5486359B244C06BAAFEC8D1685B177E1A26E0BE21E8",
    "DC3001D4481F1EB2FD2208C3B0B133D85FC16ED01A9561BD0D380EB4865DA626",
    "DF42ED256850DB7B95C17FF0A90379A23D60C6CC95284D675C37B3ADBC56FDA5",
    "101EAE608EFA210A527FE1443851670D75021E74797A838A4FE56B6B32E69287",
    "D34D98B92642E41BE5450D85D62A43B8E913F11FDFCCC6D9B0463609E20ECD34",
    "F38FA01AD748575873C32F3973F2C951AA222E1C577F7420A4B7C7FA10508144",
    "F5070647410CEC106FFF9F5FB820DC8CD1FF8201AFD31C282A49CF62B18B99CA"
]

with open(Path(__file__).parent.parent.joinpath("AndroZoo_API_key.txt")) as f:
    api_key = f.readline().strip()
base_url = "https://androzoo.uni.lu/api/download"
while True:
    fail = 0
    for sha256 in sha256s:
        apkPath = Path(f"dataset/TriggerZoo/{sha256}.apk")
        if apkPath.exists():
            print(apkPath, "exist")
            continue
        params = {
            'apikey': api_key,
            'sha256': sha256
        }
        response = requests.get(base_url, params=params, stream=True)
        
        if response.status_code == 200:
            with open(apkPath, 'wb') as file:
                for chunk in response.iter_content(chunk_size=8192):
                    file.write(chunk)
            print(f"Downloaded {apkPath}")
        else:
            print(f"Failed to download {sha256}: Status code {response.status_code}")
            fail = 1
    if fail == 0:
        break
